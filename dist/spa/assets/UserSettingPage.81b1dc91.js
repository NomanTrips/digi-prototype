import{_ as k,X as S,r as w,Y as r,aF as y,a5 as i,K as n,a6 as C,a0 as s,$ as e,ad as b,ac as Q,aG as q,d as f,a2 as h,a3 as g,ae as v,ab as A,Z as _,aa as B,af as z,a9 as d}from"./index.e7b62ae1.js";import{Q as P}from"./QBanner.0e61d121.js";import{Q as u,a as j,C as $}from"./ClosePopup.8339d8cb.js";import{b as I,Q as c,a as m}from"./position-engine.20e2b198.js";import{a as p}from"./index.becf6c0c.js";import{_ as V,a as D,b as F,c as N,d as x}from"./human_5.c88aa902.js";const T=S({name:"UserSettingsPage",data:function(){return{username:null,user_id:null,avatar:"human_1",bot_avatar:"default",is_updating:!1,err_msg:"",is_failure:!1,is_signed_in:!1,is_loading:!1,stripe_customer_id:null,subscription_status:"",premium_tf:!1}},computed:{account_tier(){var t=this;return t.premium_tf?"Premium":"Free tier"},getHumanAvatarPath(){var t=this;return t.is_loading?"/icons/white_square.png":t.avatar==="human_2"?"/icons/human_2.png":t.avatar==="human_3"?"/icons/human_3.png":t.avatar==="human_4"?"/icons/human_4.png":t.avatar==="human_5"?"/icons/human_5.png":"/icons/human_1.png"}},created:function(){var t=this;localStorage.user_id&&(t.user_id=localStorage.user_id,t.is_signed_in=!0,t.username=localStorage.username),t.get_billing_details(),t.getSettings(),localStorage.premium_tf==="true"&&(t.premium_tf=!0)},methods:{get_billing_details:function(){var t=this;p.get(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/billing`).then(function(a){console.log(a),t.stripe_customer_id=a.data.stripe_customer_id,t.subscription_status=a.data.subscription_status,t.subscription_status===null&&(t.subscription_status="N/A")}).catch(function(a){console.log(a),t.is_failure=!0,t.err_msg=a}).then(function(){})},manage_billing:function(){var t=this;p.post("https://digissist-server.azurewebsites.net/stripe/customer_portal",{customer_id:t.stripe_customer_id}).then(function(a){console.log(a),window.location.href=a.data.url}).catch(function(a){console.log(a),t.is_failure=!0,t.err_msg=a}).then(function(){})},set_avatar:function(t){console.log(t);var a=this;a.avatar=t,a.show_avatars=!1,a.updateSettings()},updateSettings:function(){var t=this;t.is_failure=!1,t.is_updating=!0;const a={"Content-Type":"application/json",Authorization:"Bearer "+localStorage.token};p.post(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/settings`,{bot_avatar:t.bot_avatar,avatar:t.avatar},{headers:a}).then(function(o){console.log(o),o.status===200?t.$router.go():(t.is_failure=!0,t.err_msg="Failed to update setting")}).catch(function(o){console.log(o),t.is_failure=!0,t.err_msg=o,o.response.status==403&&(localStorage.removeItem("user_id"),localStorage.removeItem("token"),t.is_signed_in=!1,t.$router.push("/login"))}).then(function(){t.is_updating=!1})},getSettings:function(){var t=this;t.is_loading=!0,t.is_signed_in&&p.get(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/settings`,{headers:{Authorization:"Bearer "+localStorage.token}}).then(function(a){t.bot_avatar=a.data.bot_avatar,t.avatar=a.data.avatar}).catch(function(a){console.log(a),a.response.status==403&&(localStorage.removeItem("user_id"),localStorage.removeItem("token"),t.is_signed_in=!1,t.$router.push("/login"))}).then(function(){t.is_loading=!1})}},setup(){return{show_avatars:w(!1)}}}),U={class:"q-pa-md q-gutter-sm"},E={class:"q-pa-md row justify-center"},H={style:{width:"100%","max-width":"500px"}},G={class:"row justify-center"},K=["src"],L=h(" Pick an Avatar "),M={class:"row justify-center text-caption"},O={class:"row justify-center text-subtitle1 q-mt-md q-mb-xs"},R=i("b",null,"Account type:",-1),X={class:"row justify-center text-body1 q-ma-md"},Y=i("b",null,"Subscription status:",-1),Z={class:"row justify-center q-ma-md"},J=i("div",{class:"text-h6"},"Pick your avatar:",-1),W={class:"q-pa-md"},tt=i("img",{src:V},null,-1),at=i("img",{src:D},null,-1),et=i("img",{src:F},null,-1),st=i("img",{src:N},null,-1),it=i("img",{src:x},null,-1);function nt(t,a,o,ot,lt,rt){return r(),y(q,null,[i("div",U,[n(s(P,{"inline-actions":"",rounded:"",class:"bg-orange text-white"},{action:e(()=>[s(f,{flat:"",label:"Dismiss"})]),default:e(()=>[h(" Error: "+g(t.err_msg)+" ",1)]),_:1},512),[[C,t.is_failure]])]),i("div",E,[i("div",H,[s(b,{class:"my-card"},{default:e(()=>[s(v,null,{default:e(()=>[i("div",G,[s(f,{round:"",onClick:a[0]||(a[0]=l=>t.show_avatars=!0)},{default:e(()=>[s(u,{size:"64px"},{default:e(()=>[i("img",{src:t.getHumanAvatarPath},null,8,K)]),_:1}),s(j,null,{default:e(()=>[L]),_:1})]),_:1})]),i("div",M,g(t.username),1),i("div",O,[R,i("div",{class:"text-subtitle1",style:A([t.premium_tf===!0?{color:"goldenrod"}:{color:"black"}])}," \xA0 "+g(t.account_tier),5)]),i("div",X,[Y,h(" \xA0"+g(t.subscription_status),1)]),i("div",Z,[n(s(f,{color:"pink",outline:"",label:"Manage Billing",onClick:t.manage_billing,class:"q-mx-xs"},null,8,["onClick"]),[[$]])])]),_:1})]),_:1})])]),s(Q,{modelValue:t.show_avatars,"onUpdate:modelValue":a[6]||(a[6]=l=>t.show_avatars=l)},{default:e(()=>[s(b,{class:"my-card",style:{width:"400px"}},{default:e(()=>[s(v,null,{default:e(()=>[J]),_:1}),s(v,null,{default:e(()=>[i("div",W,[s(I,{bordered:"",separator:""},{default:e(()=>[n((r(),_(m,{clickable:"",onClick:a[1]||(a[1]=l=>t.set_avatar("human_1"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[tt]),_:1})]),_:1})]),_:1})),[[d]]),n((r(),_(m,{clickable:"",onClick:a[2]||(a[2]=l=>t.set_avatar("human_2"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[at]),_:1})]),_:1})]),_:1})),[[d]]),n((r(),_(m,{clickable:"",onClick:a[3]||(a[3]=l=>t.set_avatar("human_3"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[et]),_:1})]),_:1})]),_:1})),[[d]]),n((r(),_(m,{clickable:"",onClick:a[4]||(a[4]=l=>t.set_avatar("human_4"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[st]),_:1})]),_:1})]),_:1})),[[d]]),n((r(),_(m,{clickable:"",onClick:a[5]||(a[5]=l=>t.set_avatar("human_5"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[it]),_:1})]),_:1})]),_:1})),[[d]])]),_:1})])]),_:1}),s(B),s(z,{align:"right"},{default:e(()=>[n(s(f,{outline:"",color:"pink",label:"Okay"},null,512),[[$]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var gt=k(T,[["render",nt]]);export{gt as default};
