import{_ as c,Y as m,a5 as p,Z as g,aH as f,a7 as o,L as w,a8 as h,a1 as i,a0 as n,af as b,aI as v,e as l,a3 as d,a4 as S,ag as y,aM as r,Q as k}from"./index.110ba73c.js";import{Q as P}from"./QBanner.2af9dd54.js";import{Q}from"./QForm.4a49e5bb.js";import{a as u}from"./index.becf6c0c.js";const $=m({name:"LoginPage",data:function(){return{username:"",password:"",is_failure:!1,err_msg:"",isPwd:!0,stripe_customer_id:null,subscription_status:null,is_signed_in:!1,is_loading:!1}},created:function(){var e=this;localStorage.user_id&&(e.is_signed_in=!0)},mounted:function(){},methods:{get_billing_details:function(e){var s=this;localStorage.user_id!==void 0&&u.get(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/billing`).then(function(t){s.stripe_customer_id=t.data.stripe_customer_id,s.subscription_status=t.data.subscription_status,s.subscription_status=="active"||s.subscription_status=="complete"?localStorage.premium_tf=!0:localStorage.premium_tf=!1}).catch(function(t){console.log(t),s.is_failure=!0,s.err_msg=t}).then(function(){s.emitter.emit("login_change",{premium_tf:localStorage.premium_tf,is_signed_in:s.is_signed_in,temp_account_tf:s.temp_account_tf}),e()})},onSubmit:function(){var e=this;e.is_failure=!1,e.is_loading=!0;const s={"Content-Type":"application/json"};u.post("https://digissist-server.azurewebsites.net/users/login",{username:e.username,password:e.password},{headers:s}).then(function(t){console.log(t),t.status===200?(console.log(`login resp data:  ${t.data}`),localStorage.user_id=t.data.user_id,localStorage.token=t.data.token,localStorage.username=t.data.username,localStorage.temp_account_tf=!1,e.temp_account_tf=!1,e.is_signed_in=!0,localStorage.is_signed_in=!0,e.emitter.emit("login_change",{premium_tf:localStorage.premium_tf,is_signed_in:e.is_signed_in,temp_account_tf:e.temp_account_tf}),e.get_billing_details(function(){window.location.reload()}),e.$router.push("/")):(e.is_failure=!0,e.err_msg="Unknown")}).catch(function(t){console.log(t),e.is_failure=!0,e.err_msg="error"}).then(function(){e.is_loading=!1})}}}),V={class:"q-pa-md q-gutter-sm"},q={class:"q-pa-md row justify-center"},C={style:{width:"100%","max-width":"500px"}},B={class:"row"},z={class:"q-pl-xs"},L={class:"q-pl-xs"},U={class:"row"},D={class:"q-pa-sm"},F=d("Forgot password?");function I(e,s,t,N,j,T){const _=p("router-link");return g(),f(v,null,[o("div",V,[w(i(P,{"inline-actions":"",rounded:"",class:"bg-orange text-white"},{action:n(()=>[i(l,{flat:"",label:"Dismiss"})]),default:n(()=>[d(" Sign in failed: "+S()+" ",1)]),_:1},512),[[h,e.is_failure]])]),o("div",q,[o("div",C,[i(b,{class:"my-card"},{default:n(()=>[i(y,null,{default:n(()=>[i(Q,{onSubmit:e.onSubmit,class:"q-gutter-md"},{default:n(()=>[i(r,{filled:"",color:"pink",modelValue:e.username,"onUpdate:modelValue":s[0]||(s[0]=a=>e.username=a),label:"Username","lazy-rules":"",rules:[a=>a&&a.length>0||"Please enter your username"]},null,8,["modelValue","rules"]),i(r,{filled:"",type:e.isPwd?"password":"text",color:"pink",modelValue:e.password,"onUpdate:modelValue":s[2]||(s[2]=a=>e.password=a),label:"Password","lazy-rules":"",rules:[a=>a!==null&&a!==""||"Please type your password"]},{append:n(()=>[i(k,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[1]||(s[1]=a=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["type","modelValue","rules"]),o("div",B,[o("div",z,[i(l,{outline:"",label:"Login",type:"submit",color:"pink",disable:e.is_loading,loading:e.is_loading},null,8,["disable","loading"])]),o("div",L,[i(l,{outline:"",label:"Signup",color:"pink",to:"/signup",disable:e.is_loading},null,8,["disable"])])])]),_:1},8,["onSubmit"]),o("div",U,[o("div",D,[i(_,{to:"/resetpassword"},{default:n(()=>[F]),_:1})])])]),_:1})]),_:1})])])],64)}var Z=c($,[["render",I]]);export{Z as default};
