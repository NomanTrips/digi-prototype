import{_,X as m,a4 as p,Y as f,aF as g,a5 as o,K as w,a6 as h,a0 as i,$ as n,ad as b,aG as v,d as l,a2 as u,a3 as S,ae as y,aI as r,Q as k}from"./index.b632846d.js";import{Q as $}from"./QBanner.3aaaa684.js";import{Q as P}from"./QForm.d3b921fa.js";import{a as d}from"./index.becf6c0c.js";const Q=m({name:"LoginPage",data:function(){return{username:"",password:"",is_failure:!1,err_msg:"",isPwd:!0,stripe_customer_id:null,subscription_status:null,is_signed_in:!1,is_loading:!1}},created:function(){var e=this;localStorage.user_id&&(e.is_signed_in=!0)},mounted:function(){var e=this;e.is_signed_in&&e.$router.push("/")},methods:{get_billing_details:function(e){var a=this;localStorage.user_id!==void 0&&d.get(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/billing`).then(function(s){a.stripe_customer_id=s.data.stripe_customer_id,a.subscription_status=s.data.subscription_status,a.subscription_status==="active"?localStorage.premium_tf=!0:localStorage.premium_tf=!1}).catch(function(s){console.log(s),a.is_failure=!0,a.err_msg=s}).then(function(){e()})},onSubmit:function(){var e=this;e.is_failure=!1,e.is_loading=!0;const a={"Content-Type":"application/json"};d.post("https://digissist-server.azurewebsites.net/users/login",{username:e.username,password:e.password},{headers:a}).then(function(s){console.log(s),s.status===200?(console.log(`login resp data:  ${s.data}`),localStorage.user_id=s.data.user_id,localStorage.token=s.data.token,localStorage.username=s.data.username,e.is_signed_in=!0,e.get_billing_details(function(){window.location.reload()})):(e.is_failure=!0,e.err_msg="Unknown")}).catch(function(s){console.log(s),e.is_failure=!0,e.err_msg="error"}).then(function(){e.is_loading=!1})}}}),V={class:"q-pa-md q-gutter-sm"},q={class:"q-pa-md row justify-center"},C={style:{width:"100%","max-width":"500px"}},B={class:"row"},z={class:"q-pl-xs"},F={class:"q-pl-xs"},U={class:"row"},D={class:"q-pa-sm"},I=u("Forgot password?");function L(e,a,s,N,j,T){const c=p("router-link");return f(),g(v,null,[o("div",V,[w(i($,{"inline-actions":"",rounded:"",class:"bg-orange text-white"},{action:n(()=>[i(l,{flat:"",label:"Dismiss"})]),default:n(()=>[u(" Sign in failed: "+S()+" ",1)]),_:1},512),[[h,e.is_failure]])]),o("div",q,[o("div",C,[i(b,{class:"my-card"},{default:n(()=>[i(y,null,{default:n(()=>[i(P,{onSubmit:e.onSubmit,class:"q-gutter-md"},{default:n(()=>[i(r,{filled:"",color:"pink",modelValue:e.username,"onUpdate:modelValue":a[0]||(a[0]=t=>e.username=t),label:"Username","lazy-rules":"",rules:[t=>t&&t.length>0||"Please enter your username"]},null,8,["modelValue","rules"]),i(r,{filled:"",type:e.isPwd?"password":"text",color:"pink",modelValue:e.password,"onUpdate:modelValue":a[2]||(a[2]=t=>e.password=t),label:"Password","lazy-rules":"",rules:[t=>t!==null&&t!==""||"Please type your password"]},{append:n(()=>[i(k,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:a[1]||(a[1]=t=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["type","modelValue","rules"]),o("div",B,[o("div",z,[i(l,{outline:"",label:"Login",type:"submit",color:"pink",disable:e.is_loading,loading:e.is_loading},null,8,["disable","loading"])]),o("div",F,[i(l,{outline:"",label:"Signup",color:"pink",to:"/signup",disable:e.is_loading},null,8,["disable"])])])]),_:1},8,["onSubmit"]),o("div",U,[o("div",D,[i(c,{to:"/resetpassword"},{default:n(()=>[I]),_:1})])])]),_:1})]),_:1})])])],64)}var Y=_(Q,[["render",L]]);export{Y as default};
