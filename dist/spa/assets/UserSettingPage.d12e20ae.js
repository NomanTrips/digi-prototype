import{_ as k,X as w,r as S,Y as l,aF as y,a5 as i,K as n,a6 as C,a0 as s,$ as e,ad as b,ac as Q,aG as q,d as f,a2 as h,a3 as g,ae as p,Z as _,aa as B,af as A,a9 as d}from"./index.13a4cd04.js";import{Q as P}from"./QBanner.3817c1ee.js";import{Q as u,a as j,C as $}from"./ClosePopup.c71c635c.js";import{b as z,Q as c,a as m}from"./position-engine.359a20bd.js";import{a as v}from"./index.becf6c0c.js";import{_ as I,a as V,b as D,c as F,d as N}from"./human_5.c88aa902.js";const T=w({name:"UserSettingsPage",data:function(){return{username:null,user_id:null,avatar:"human_1",bot_avatar:"default",is_updating:!1,err_msg:"",is_failure:!1,is_signed_in:!1,is_loading:!1,stripe_customer_id:null,subscription_status:""}},computed:{account_tier(){var t=this;return t.subscription_status==="active"?"Premium":"Free"},getHumanAvatarPath(){var t=this;return t.is_loading?"/icons/white_square.png":t.avatar==="human_2"?"/icons/human_2.png":t.avatar==="human_3"?"/icons/human_3.png":t.avatar==="human_4"?"/icons/human_4.png":t.avatar==="human_5"?"/icons/human_5.png":"/icons/human_1.png"}},created:function(){var t=this;localStorage.user_id&&(t.user_id=localStorage.user_id,t.is_signed_in=!0,t.username=localStorage.username),t.get_billing_details()},methods:{get_billing_details:function(){var t=this;v.get(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/billing`).then(function(a){console.log(a),t.stripe_customer_id=a.data.stripe_customer_id,t.subscription_status=a.data.subscription_status}).catch(function(a){console.log(a),t.is_failure=!0,t.err_msg=a}).then(function(){})},manage_billing:function(){var t=this;v.post("https://digissist-server.azurewebsites.net/stripe/customer_portal",{customer_id:t.stripe_customer_id}).then(function(a){console.log(a),window.location.href=a.data.url}).catch(function(a){console.log(a),t.is_failure=!0,t.err_msg=a}).then(function(){})},set_avatar:function(t){console.log(t);var a=this;a.avatar=t,a.show_avatars=!1,a.updateSettings()},updateSettings:function(){var t=this;t.is_failure=!1,t.is_updating=!0;const a={"Content-Type":"application/json",Authorization:"Bearer "+localStorage.token};v.post(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/settings`,{bot_avatar:t.bot_avatar,avatar:t.avatar},{headers:a}).then(function(o){console.log(o),o.status===200?t.$router.go():(t.is_failure=!0,t.err_msg="Failed to update setting")}).catch(function(o){console.log(o),t.is_failure=!0,t.err_msg=o,o.response.status==403&&(localStorage.removeItem("user_id"),localStorage.removeItem("token"),t.is_signed_in=!1,t.$router.push("/login"))}).then(function(){t.is_updating=!1})},getSettings:function(){var t=this;t.is_loading=!0,t.is_signed_in&&v.get(`https://digissist-server.azurewebsites.net/users/${localStorage.user_id}/settings`,{headers:{Authorization:"Bearer "+localStorage.token}}).then(function(a){t.bot_avatar=a.data.bot_avatar,t.avatar=a.data.avatar}).catch(function(a){console.log(a),a.response.status==403&&(localStorage.removeItem("user_id"),localStorage.removeItem("token"),t.is_signed_in=!1,t.$router.push("/login"))}).then(function(){t.is_loading=!1})}},setup(){return{show_avatars:S(!1)}}}),U={class:"q-pa-md q-gutter-sm"},x={class:"q-pa-md row justify-center"},E={style:{width:"100%","max-width":"500px"}},H={class:"row justify-center"},G=["src"],K=h(" Pick an Avatar "),L={class:"row justify-center text-caption"},M={class:"row justify-center text-body1 q-ma-md"},O=h("Account tier:\xA0"),R={style:{color:"goldenrod"}},X={class:"row justify-center text-body1 q-ma-md"},Y={class:"row justify-center q-ma-md"},Z=i("div",{class:"text-h6"},"Pick your avatar:",-1),J={class:"q-pa-md"},W=i("img",{src:I},null,-1),tt=i("img",{src:V},null,-1),at=i("img",{src:D},null,-1),et=i("img",{src:F},null,-1),st=i("img",{src:N},null,-1);function it(t,a,o,nt,ot,rt){return l(),y(q,null,[i("div",U,[n(s(P,{"inline-actions":"",rounded:"",class:"bg-orange text-white"},{action:e(()=>[s(f,{flat:"",label:"Dismiss"})]),default:e(()=>[h(" Error: "+g(t.err_msg)+" ",1)]),_:1},512),[[C,t.is_failure]])]),i("div",x,[i("div",E,[s(b,{class:"my-card"},{default:e(()=>[s(p,null,{default:e(()=>[i("div",H,[s(f,{round:"",onClick:a[0]||(a[0]=r=>t.show_avatars=!0)},{default:e(()=>[s(u,{size:"64px"},{default:e(()=>[i("img",{src:t.getHumanAvatarPath},null,8,G)]),_:1}),s(j,null,{default:e(()=>[K]),_:1})]),_:1})]),i("div",L,g(t.username),1),i("div",M,[O,i("div",R,g(t.account_tier),1)]),i("div",X,"Subscription status: "+g(t.subscription_status),1),i("div",Y,[n(s(f,{color:"pink",outline:"",label:"Manage Billing",onClick:t.manage_billing,class:"q-mx-xs"},null,8,["onClick"]),[[$]])])]),_:1})]),_:1})])]),s(Q,{modelValue:t.show_avatars,"onUpdate:modelValue":a[6]||(a[6]=r=>t.show_avatars=r)},{default:e(()=>[s(b,{class:"my-card",style:{width:"400px"}},{default:e(()=>[s(p,null,{default:e(()=>[Z]),_:1}),s(p,null,{default:e(()=>[i("div",J,[s(z,{bordered:"",separator:""},{default:e(()=>[n((l(),_(m,{clickable:"",onClick:a[1]||(a[1]=r=>t.set_avatar("human_1"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[W]),_:1})]),_:1})]),_:1})),[[d]]),n((l(),_(m,{clickable:"",onClick:a[2]||(a[2]=r=>t.set_avatar("human_2"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[tt]),_:1})]),_:1})]),_:1})),[[d]]),n((l(),_(m,{clickable:"",onClick:a[3]||(a[3]=r=>t.set_avatar("human_3"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[at]),_:1})]),_:1})]),_:1})),[[d]]),n((l(),_(m,{clickable:"",onClick:a[4]||(a[4]=r=>t.set_avatar("human_4"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[et]),_:1})]),_:1})]),_:1})),[[d]]),n((l(),_(m,{clickable:"",onClick:a[5]||(a[5]=r=>t.set_avatar("human_5"))},{default:e(()=>[s(c,null,{default:e(()=>[s(u,null,{default:e(()=>[st]),_:1})]),_:1})]),_:1})),[[d]])]),_:1})])]),_:1}),s(B),s(A,{align:"right"},{default:e(()=>[n(s(f,{outline:"",color:"pink",label:"Okay"},null,512),[[$]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var ft=k(T,[["render",it]]);export{ft as default};
